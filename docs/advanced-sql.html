<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Advanced SQL | Database Notes</title>
  <meta name="description" content="This is the online pamplet to an exhibition of dragons in Chinese art. This is part of a final curation project for History of Chinese Art at NYU Shanghai Fall 2020." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Advanced SQL | Database Notes" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://sc6354.github.io/hoca_final_project_exhibition_pamphlet/" />
  <meta property="og:image" content="https://sc6354.github.io/hoca_final_project_exhibition_pamphlet/images/cover.PNG" />
  <meta property="og:description" content="This is the online pamplet to an exhibition of dragons in Chinese art. This is part of a final curation project for History of Chinese Art at NYU Shanghai Fall 2020." />
  <meta name="github-repo" content="sc6354/hoca_final_project_exhibition_pamphlet" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Advanced SQL | Database Notes" />
  
  <meta name="twitter:description" content="This is the online pamplet to an exhibition of dragons in Chinese art. This is part of a final curation project for History of Chinese Art at NYU Shanghai Fall 2020." />
  <meta name="twitter:image" content="https://sc6354.github.io/hoca_final_project_exhibition_pamphlet/images/cover.PNG" />

<meta name="author" content="Susan Chen" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/favicon_io/apple-touch-icon.png" />
  <link rel="shortcut icon" href="images/favicon_io/favicon.ico" type="image/x-icon" />
<link rel="prev" href="intermediate-sql.html"/>
<link rel="next" href="database-design-using-the-e-r-model.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="./"><img src="images/cover.PNG"></a></li>
<li>Database Notes</li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Note to Readers</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reading-guide"><i class="fa fa-check"></i>Reading guide</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="course-outline.html"><a href="course-outline.html"><i class="fa fa-check"></i>Course Outline</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#database-system-applications"><i class="fa fa-check"></i><b>1.1</b> Database System Applications</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#purpose-of-database-system"><i class="fa fa-check"></i><b>1.2</b> Purpose of Database System</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#view-of-data"><i class="fa fa-check"></i><b>1.3</b> View of Data</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#database-languages"><i class="fa fa-check"></i><b>1.4</b> Database Languages</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#database-design"><i class="fa fa-check"></i><b>1.5</b> Database Design</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#database-engine"><i class="fa fa-check"></i><b>1.6</b> Database Engine</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#database-application-architecture"><i class="fa fa-check"></i><b>1.7</b> Database &amp; Application Architecture</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#database-users-and-administrators"><i class="fa fa-check"></i><b>1.8</b> Database Users and Administrators</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html"><i class="fa fa-check"></i><b>2</b> Introduction to the Relational Model</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html#structure-of-the-relational-databases"><i class="fa fa-check"></i><b>2.1</b> Structure of the Relational Databases</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html#database-schema"><i class="fa fa-check"></i><b>2.2</b> Database Schema</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html#excluded"><i class="fa fa-check"></i><b>2.3</b> EXCLUDED</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html#schema-diagrams"><i class="fa fa-check"></i><b>2.4</b> Schema Diagrams</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html#relational-query-language"><i class="fa fa-check"></i><b>2.5</b> Relational Query Language</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-the-relational-model.html"><a href="introduction-to-the-relational-model.html#relational-algebra"><i class="fa fa-check"></i><b>2.6</b> Relational Algebra</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html"><i class="fa fa-check"></i><b>3</b> Introduction to SQL</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#overview-of-the-original-version-of-sql"><i class="fa fa-check"></i><b>3.1</b> Overview of the original version of SQL</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#sql-data-defintion"><i class="fa fa-check"></i><b>3.2</b> SQL Data Defintion</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#basic-structure-of-sql-queries"><i class="fa fa-check"></i><b>3.3</b> Basic structure of SQL queries</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#additional-basic-operations"><i class="fa fa-check"></i><b>3.4</b> Additional Basic Operations</a></li>
<li class="chapter" data-level="3.5" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#set-operations"><i class="fa fa-check"></i><b>3.5</b> Set Operations</a></li>
<li class="chapter" data-level="3.6" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#null-values"><i class="fa fa-check"></i><b>3.6</b> Null Values</a></li>
<li class="chapter" data-level="3.7" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#aggregate-functions"><i class="fa fa-check"></i><b>3.7</b> Aggregate Functions</a></li>
<li class="chapter" data-level="3.8" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#nested-subqueries"><i class="fa fa-check"></i><b>3.8</b> Nested Subqueries</a></li>
<li class="chapter" data-level="3.9" data-path="introduction-to-sql.html"><a href="introduction-to-sql.html#modification-of-the-databases"><i class="fa fa-check"></i><b>3.9</b> Modification of the Databases</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="intermediate-sql.html"><a href="intermediate-sql.html"><i class="fa fa-check"></i><b>4</b> Intermediate SQL</a>
<ul>
<li class="chapter" data-level="4.1" data-path="intermediate-sql.html"><a href="intermediate-sql.html#example-one"><i class="fa fa-check"></i><b>4.1</b> Example one</a></li>
<li class="chapter" data-level="4.2" data-path="intermediate-sql.html"><a href="intermediate-sql.html#example-two"><i class="fa fa-check"></i><b>4.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="advanced-sql.html"><a href="advanced-sql.html"><i class="fa fa-check"></i><b>5</b> Advanced SQL</a>
<ul>
<li class="chapter" data-level="5.1" data-path="advanced-sql.html"><a href="advanced-sql.html#accessing-sql-from-a-programming-language"><i class="fa fa-check"></i><b>5.1</b> Accessing SQL from a Programming Language</a></li>
<li class="chapter" data-level="5.2" data-path="advanced-sql.html"><a href="advanced-sql.html#functions-and-procedures"><i class="fa fa-check"></i><b>5.2</b> Functions and Procedures</a></li>
<li class="chapter" data-level="5.3" data-path="advanced-sql.html"><a href="advanced-sql.html#triggers"><i class="fa fa-check"></i><b>5.3</b> Triggers</a></li>
<li class="chapter" data-level="5.4" data-path="advanced-sql.html"><a href="advanced-sql.html#recursive-queries"><i class="fa fa-check"></i><b>5.4</b> Recursive Queries</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="database-design-using-the-e-r-model.html"><a href="database-design-using-the-e-r-model.html"><i class="fa fa-check"></i><b>6</b> Database Design using the E-R Model</a></li>
<li class="chapter" data-level="7" data-path="relational-database-design.html"><a href="relational-database-design.html"><i class="fa fa-check"></i><b>7</b> Relational Database Design</a>
<ul>
<li class="chapter" data-level="7.1" data-path="relational-database-design.html"><a href="relational-database-design.html#features-of-a-good-relational-design"><i class="fa fa-check"></i><b>7.1</b> Features of a Good Relational Design</a></li>
<li class="chapter" data-level="7.2" data-path="relational-database-design.html"><a href="relational-database-design.html#decomposition-using-functional-dependencies"><i class="fa fa-check"></i><b>7.2</b> Decomposition using Functional Dependencies</a></li>
<li class="chapter" data-level="7.3" data-path="relational-database-design.html"><a href="relational-database-design.html#normal-forms"><i class="fa fa-check"></i><b>7.3</b> Normal Forms</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="skipped-ch-8.html"><a href="skipped-ch-8.html"><i class="fa fa-check"></i><b>8</b> Skipped Ch. 8</a></li>
<li class="chapter" data-level="9" data-path="application-development.html"><a href="application-development.html"><i class="fa fa-check"></i><b>9</b> Application Development</a>
<ul>
<li class="chapter" data-level="9.1" data-path="application-development.html"><a href="application-development.html#application-programs-user-interfaces"><i class="fa fa-check"></i><b>9.1</b> Application Programs &amp; User Interfaces</a></li>
<li class="chapter" data-level="9.2" data-path="application-development.html"><a href="application-development.html#web-fundamentals"><i class="fa fa-check"></i><b>9.2</b> Web Fundamentals</a></li>
<li class="chapter" data-level="9.3" data-path="application-development.html"><a href="application-development.html#servlets"><i class="fa fa-check"></i><b>9.3</b> Servlets</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="skipped-ch-10.html"><a href="skipped-ch-10.html"><i class="fa fa-check"></i><b>10</b> Skipped Ch. 10</a></li>
<li class="chapter" data-level="11" data-path="indexing.html"><a href="indexing.html"><i class="fa fa-check"></i><b>11</b> indexing</a></li>
<li class="chapter" data-level="12" data-path="storage.html"><a href="storage.html"><i class="fa fa-check"></i><b>12</b> Storage</a>
<ul>
<li class="chapter" data-level="12.1" data-path="storage.html"><a href="storage.html#overview-of-physical-storage-media"><i class="fa fa-check"></i><b>12.1</b> Overview of Physical Storage Media</a></li>
<li class="chapter" data-level="12.2" data-path="storage.html"><a href="storage.html#storage-interfaces"><i class="fa fa-check"></i><b>12.2</b> Storage Interfaces</a></li>
<li class="chapter" data-level="12.3" data-path="storage.html"><a href="storage.html#magnetic-disks"><i class="fa fa-check"></i><b>12.3</b> Magnetic Disks</a></li>
<li class="chapter" data-level="12.4" data-path="storage.html"><a href="storage.html#performance-measurement-of-disks"><i class="fa fa-check"></i><b>12.4</b> Performance measurement of disks</a></li>
<li class="chapter" data-level="12.5" data-path="storage.html"><a href="storage.html#flash-storage"><i class="fa fa-check"></i><b>12.5</b> Flash Storage</a></li>
<li class="chapter" data-level="12.6" data-path="storage.html"><a href="storage.html#optimization-of-disk-block-access"><i class="fa fa-check"></i><b>12.6</b> Optimization of Disk-block Access</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="skipped.html"><a href="skipped.html"><i class="fa fa-check"></i><b>13</b> Skipped</a></li>
<li class="chapter" data-level="14" data-path="transactions.html"><a href="transactions.html"><i class="fa fa-check"></i><b>14</b> Transactions</a>
<ul>
<li class="chapter" data-level="14.1" data-path="transactions.html"><a href="transactions.html#transaction-concept"><i class="fa fa-check"></i><b>14.1</b> Transaction Concept</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.linkedin.com/in/susan-chen-12787517a/" target="blank">My Linkedin</a></li>
<li><a href = "https://github.com/sc6354/databases_notes" target="blank">Link to Project Repository</a></li>
<li><a>  </a></li>
<li><a>  </a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Database Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<link href="style.css" rel="stylesheet">
<link rel="shortcut icon" href="images/favicon.io/apple-touch-icon.png" />
<div id="advanced-sql" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Advanced SQL</h1>
<div id="accessing-sql-from-a-programming-language" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Accessing SQL from a Programming Language</h2>
<ol style="list-style-type: lower-alpha">
<li><p>Database programmer must have access to a general programming language b/c…</p>
<ul>
<li>NOT all queries can be expressed in SQL</li>
<li>Nondeclarative actions such as printing a report, or sending the results of a query to a graphical user interface; querying data is just one of the many components of an App.
<span class="math display">\[\\[.1cm]\]</span></li>
</ul></li>
<li><p>There are 2 general approaches to accessing SQL through a general programming language: <strong>Dynamic SQL</strong> or <strong>Embbedded SQL</strong></p></li>
<li><p><code>DYNAMIC SQL</code> - allows general purpose programs to connect and communicate w/a database server using a colleciton of functions and methods</p>
<ul>
<li>JDBC - appplication program interface for Java</li>
<li>ODBC - for C language, C++, C#, Ruby, Go, PHP, Visual Basic</li>
<li>Python Database API - for Python</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li><p><code>EMBEDDED SQL</code> - allows functions calls to connect to database using an API w/dynamic SQL facilities at runtime</p></li>
<li><p><code>JDBC</code> - defines the API that Java programs use to connect to database servers</p>
<ul>
<li>orginally an abbreviation for Java Database Connectivity but full form is no longer used</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Connecting to a Database in JDBC:
<ul>
<li>Select which database to use; can be an instance of Oracle running on local machine or PostgreSQL running on another machine</li>
<li>Open a connection to the database using <strong>getConnection()</strong></li>
<li><strong>getConnection()</strong> takes 3 parameters: URL/machine name of server, user identifier, and password</li>
</ul></li>
</ol>
<div class="note">
<p>Before opening a connection, the JDBC driver must be dynamically loaded first w/specified protocol like ‘jdbc:oracle:thin:’ or ‘jdbc:mysql:’</p>
</div>
<ol start="7" style="list-style-type: lower-alpha">
<li>Sending SQL statements to Database System in JDBC:
<ul>
<li>the <strong>Statement</strong> class allows the programs to send SQL statements to the database system for execution</li>
<li>a <strong>Statement</strong> object is NOT the SQL statement itself but rather an object that invokes methods that take in SQL statements as arguments and sends them to the database systems</li>
<li>use <strong>excuteQuery()</strong> method for query statements</li>
<li>use <strong>executeUpdate()</strong> method for nonquery statements (UPDATE, CREATE TABLE, INSERT, DELETE)</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span>
g. Handling Exceptions in JDBC:
- executing SQL methods can result in an exception
- the <strong>try {…} catch {…}</strong> construct can catch any JDBC errors
- <code>SQLexception</code> - SQL-specific exception
- <code>Exception</code> - regular Java errors</p>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li><code>prepareStatement()</code> - method that allows us to predefine a query statement w/“?” as placeholders for actual values to provided by user
<ul>
<li>always use prepared statements when taking an input from the user &amp; adding it to a query</li>
<li>NEVER create a query by concetanating strings of user entered inputs b/c if user enters certain special characters such as a single quote, the resulting SQL query my be syntactically incorrect</li>
<li>luckily, <strong>setString()</strong> method checks for this &amp; inserts necessary escape characters to ensure syntactic correctness</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol style="list-style-type: lower-roman">
<li><code>SQL INJECTION</code> - a code injection technique that might destroy your database
<ul>
<li><p>one of the most common web hacking techniques</p></li>
<li><p>the placement of malicious code in SQL statements via web place entered inputs</p></li>
<li><p>Injection based on <strong>1=1</strong> is always TRUE</p>
<pre><code>Ex. 
userID: 105 or 1=1
Corresponding SQL: SELECT * FROM users WHERE userID=105 OR 1=1</code></pre></li>
</ul></li>
</ol>
<div class="note">
<p>the sql is valid and will return all rows from the <code>User</code> Table since 1=1 is always True</p>
</div>
<ul>
<li><p>Injection based on "“=”" is always True</p>
<pre><code>Ex. username: &quot; or &quot;&quot;=&quot;  
    password: &quot; or &quot;&quot;=&quot; 
    SQL: SELECT * FROM users WHERE Name=&quot;&quot; or &quot;&quot;=&quot;&quot; AND pass=&quot;&quot; or &quot;&quot;=&quot;&quot;</code></pre></li>
</ul>
<div class="note">
<p>the sql is valid and will return all rows from the <code>User</code> Table b/c “‘=’” is always True</p>
</div>
<ul>
<li><p>injection based on Batched SQL statements (group of 2 or more SQL statements seperated by semicolon)</p>
<pre><code>Ex. userId: 105; DROP TABLE suppliers
SQL: SELECT userID FROM User where userId =105; DROP TABLE suppliers</code></pre></li>
</ul>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="10" style="list-style-type: lower-alpha">
<li>METADATA FEATURES - Java App does not have declarations for data stored in database &amp; must either have it <em>hard-coded</em> or <em>determine</em> the info. directly at runtime
<ul>
<li>when an <strong>executeQuery()</strong> method is executed, it returns a result set object, which contain the method <strong>getMetadata()</strong></li>
<li><strong>getMetadata()</strong> returns ResultSetMetaData object w/methods to find Metadata info.</li>
<li><strong>getColumnCount()</strong> returns arity of the result relation</li>
<li><strong>getColumnName()</strong> returns names of the column</li>
<li><strong>getColumnTypeName()</strong> returns data types of columns</li>
<li><strong>getColumns()</strong> returns info. about columns</li>
<li><strong>getTable()</strong> returns list of all tables in database</li>
<li><strong>getPrimaryKeys()</strong></li>
<li><strong>getCrossReferences</strong> returns foreign keys</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span>
k. Handling Large Object Types:</p>
<ul>
<li><p><strong>getBlob()</strong> &amp; <strong>getClob()</strong> are similiar to <strong>getString()</strong>, but returns objects of type Blob &amp; Clob that stores locators for large objects or logical pointers to the actual object in the database</p></li>
<li><p><strong>getBytes()</strong> or <strong>getSubstring()</strong> fetches data from these objects</p></li>
<li><p>to update large objects, link an input stream to a Blob or Clob object like this…</p>
<pre><code>blob.set(int parameterIndex, Input stream inputStream);</code></pre></li>
</ul>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="12" style="list-style-type: lower-alpha">
<li><code>OPEN DATABASE CONNECTIVITY (ODBC)</code> - defines an API that apps can use to open a connection w/a database, send queries, &amp; update and get back results
<ul>
<li>apps such as GUI, spreadsheets, statistic packages can use ODBC</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span>
m. <code>EMBEDDED SQL</code>- defines the embeddings of SQL in variety of programming languages</p>
<ul>
<li><p>host language - the language to which SQL queries are embedded</p></li>
<li><p>embbedded SQL - the SQL structures permitted in the host lang.</p></li>
<li><p><strong>EXEC SQL</strong> is used in host lang. to identify embedded SQL requests to the preprocessor</p>
<pre><code>Ex. 
general form: EXEC SQL &lt; embedded SQL &gt;; 
COBOL: semeicolon is replaced by END-EXEC
Java: embeddings use #SQL {....}; </code></pre></li>
<li><p>Apps must connect to database before executing any SQL statements</p>
<pre><code>Ex. EXEC-SQL connect to server user username using password; </code></pre></li>
<li><p>Variables of host lang. can be used inside embedded SQL; they are preceded by a colon (:) &amp; must be delcared within the <strong>DECLARE</strong> section</p>
<pre><code>Ex. :credit_amount</code></pre></li>
<li><p>to write an embedded SQL query, use ’declare c cursor for <SQL query> where c identifies the query</p>
<pre><code>Ex. 
EXEC SQL 
      declare c cursor for 
      SELECT ID, name
      FROM student
      WHERE tot_cred &gt; :credit_amount
END_EXEC</code></pre></li>
</ul>
<div class="note">
<p>To actual execute the above query and save the results within a temporary relation, we must “open” it using EXEC-SQL open c;</p>
</div>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ul>
<li><p>use a fetch statement to save one row of query results to host lang. variable.</p>
<pre><code>Ex. EXEC-SQL fetch c into :si, :sn END_EXEC </code></pre></li>
<li><p>use close statement to delete temporary relation that holds the query results</p>
<pre><code>Ex. EXEC SQL close c; </code></pre></li>
</ul>
</div>
<div id="functions-and-procedures" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Functions and Procedures</h2>
<ol style="list-style-type: lower-alpha">
<li>functions &amp; procedures allow business logic to be stored in the database &amp; executed from SQL statements
<ul>
<li>they can be defined either by procedural SQL or by an external programming lang.</li>
<li>SQL syntax for implementation varies across databases</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="2" style="list-style-type: lower-alpha">
<li><p><code>FUNCTIONS</code> -</p>
<pre><code>     -Ex. Function that returns count of instructors in a department.
     CREATE Function  dept_count(dept_name varchar(20))
           returns integer 
           begin 
           declare d_count integer 
                 SELECT COUNT(*) into d_count 
                 FROM instructor
                 WHERE instructor.dept_name = dept_name
           return d_count;
     End

     -Usage:
     SELECT dept_name, budget
     FROM department
     WHERE dept_count(dept_name) &gt;12</code></pre></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li><p><code>TABLE FUNCTIONS</code> - functions that return tables as results</p>
<pre><code>     - Ex
     CREATE function instructor_of(dept_name char(20))
           returns table(
                 ID varchar(5),
                 name varchar(20),
                 dept_name varchar(20), 
                 salary numeric (8,2))
           return table 
                 (SELECT ID, name, dept_name, salary
                 FROM instructor
                 WHERE instructor.dept_name = instructor_of.dept_name)

     -Usage
     SELECT * 
     FROM table (instructor_of(&#39;Music&#39;))</code></pre></li>
</ol>
<div class="note">
<p>Returns all instructors in the music department. For a simple query like this, we probably don’t need a function. Just write a query</p>
</div>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li><p><code>PARAMETERIZED VIEWS</code> - generalized views created by table-valued functions &amp; their parameters</p></li>
<li><p><code>PROCEDURES</code> - often referred to as stored procedures; is a reusable unit of SQL statements &amp; logic, compiled &amp; stored together to perfom a specific task</p>
<pre><code>     Ex. 
     CREATE procedure dept_count_pro (IN dept_name varchar(20), OUT d_count integer)
           begin 
                 SELECT COUNT(*) into d_count 
                 FROM instructor
                 WHERE instructor.dept_name = dept_count_proc.dept_name
           end </code></pre></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="6" style="list-style-type: lower-alpha">
<li><p>Procedures can be invoked either from an SQL procedure or embedded SQL via a ‘cal’ statement</p>
<pre><code>     Ex. 
     Declare d_count integer,
     call dept_count_proc(&#39;Physic&#39;, d_count);</code></pre></li>
</ol>
<div class="note">
<p>Functions &amp; Procedures can have the same name as other functions and procedures as long as the number of arguments are different or at least one argument is different</p>
</div>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="7" style="list-style-type: lower-alpha">
<li><code>PERSISTENT STORAGE MODULE (PSM)</code>- gives SQL almost all the power of a general programming lang.</li>
</ol>
</div>
<div id="triggers" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Triggers</h2>
<ol style="list-style-type: lower-alpha">
<li><p><code>TRIGGERS</code> - a statement that the system executes automatically as a side effect of a modification to the database</p></li>
<li><p>to define a trigger, we must</p>
<ul>
<li>specify the conditions under which a trigger is to be executed</li>
<li>specify the actions to be taken when the trigger is called</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="3" style="list-style-type: lower-alpha">
<li><p>Triggers can be activated before an event (INSERT, UPDATE, or DELETE)</p></li>
<li><p>Statement-level triggers</p>
<ul>
<li>use ‘for each statement’ instead of ‘for each row’ when executing a single action for all rows affected by the transaction</li>
<li>use ‘referencing old table’ or ‘referencing new table’ to refer to temporary tables w/affected rows</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="5" style="list-style-type: lower-alpha">
<li><p>Triggers can be disable or enabled; default is enabled upon creation</p></li>
<li><p>Triggers can be dropped, which removes it permanently</p></li>
<li><p>Triggers were used earlier for tasks such as</p>
<ul>
<li>Maintaining summary data (e.g., total salary of each department)</li>
<li>Replicating databases by recording changes to special relations (called change or delta relations) and having a separate process that applies the changes over to a replica
<span class="math display">\[\\[.1cm]\]</span></li>
</ul></li>
<li><p>There are better ways of doing these now:</p>
<ul>
<li>Databases today provide built in materialized view facilities to maintain summary data</li>
<li>Databases provide built-in support for replication
<span class="math display">\[\\[.1cm]\]</span></li>
</ul></li>
<li><p>Encapsulation facilities can be used instead of triggers in many cases</p>
<ul>
<li>Define methods to update fields</li>
<li>Carry out actions as part of the update methods instead of through a trigger
<span class="math display">\[\\[.1cm]\]</span></li>
</ul></li>
<li><p>Risk of unintended execution of triggers, for example, when</p>
<ul>
<li>Loading data from a backup copy</li>
<li>Replicating updates at a remote site</li>
<li>Trigger execution can be disabled before such actions.</li>
</ul></li>
</ol>
<p><span class="math display">\[\\[.1cm]\]</span></p>
<ol start="11" style="list-style-type: lower-alpha">
<li>Other risks with triggers:
<ul>
<li>Error leading to failure of critical transactions that set off the trigger</li>
<li>Cascading execution</li>
</ul></li>
</ol>
</div>
<div id="recursive-queries" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Recursive Queries</h2>
<ol style="list-style-type: lower-alpha">
<li><p>Any recursive view must be a union of 2 subqueries: a base query that is NOT recursive &amp; a recursive query that uses a recursive view</p></li>
<li><p><code>FIXED POINT</code> - of the recursive view is the resultant view where not more new tuples are added</p></li>
<li><p>Recursive views make it possible to write queries, such as transitive closure queries, that cannot be written without recursion or iteration.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intermediate-sql.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="database-design-using-the-e-r-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "github"]
},
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["databases_notes.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "statics"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
